
## 概述

- en doc   [readme](doc/en/readme.md)
在RoboRTS的原有框架下下，删除了除底盘外的所有有额外控制的代码，保留了掉线检测，电池电量检测等相关代码，
修改了部分底盘代码，在gimble-task，chassis task ,main,macanamum以及Can ,PWM等相应类中作出修改，
使得可以控制控制了3个电机，以及3个舵机。

### 软件环境

 - Toolchain/IDE : MDK-ARM V5 / arm-none-eabi
 - package version: STM32Cube FW_F4 V1.24.0
 - FreeRTOS version: 10.0.0
 - CMSIS-RTOS version: 1.02

### 编程规范

- 变量和函数命名方式遵循 Unix/Linux 风格
- chassis\_task与gimbal\_task是强实时控制任务，优先级最高，禁止被其他任务抢占或者阻塞

### 注意事项

1.开发板C型上有一枚跳线帽，用于区分当前为底盘模块还是云台模块。出现不能控制且无声光报警请检查跳线帽是否松动。

### 模块离线说明

当车辆的某个模块离线时，可以根据声光指示进行问题定位

蜂鸣器鸣叫次数按照离线模块的优先级进行错误指示，例如云台电机优先级高于拨弹电机，如果同时发生离线，先指示当前离线设备是云台电机

模块离线对应的状态如下，数字对应蜂鸣器每次鸣叫的次数，按照优先级排序：

#### 底盘模块

1. 右前轮电机掉线
2. 左前轮电机掉线
3. 左后轮电机掉线
4. 右后轮电机掉线

#### 云台模块

5. 云台 YAW 电机掉线
6. 云台 PITCH 电机掉线
7. 拨盘电机掉线

#### 遥控器离线

此时红灯常亮，所有执行器失效。
红灯如果闪烁，需要对频，按键在DR6上。

### 文档

- 协议文档  [protocol](doc/ch/protocol.md)
- protocol [document](doc/en/protocol.md)


### 硬件接口

主控板使用国际开发板 C 型，各个功能接口的位置如下：

**云台接口**
17: pwm pin
18: trigger pin

**底盘接口**
19: firmware config pin.

**C型板上的SWD接口**
用来连接SV2-Link或J-Link连接接口

### 功能模块

提供遥控器基础控制。

##### 手动档

遥控器控制（S2处在UP状态时，控制电机转动）：右杆左右运动副控制同步带轮转动，上下运动副为控制前后丝杠运动。
遥控器控制（S2处在mid状态时，控制底盘运动）：右杆上下左右为底盘运动方向一致，左杆左右运动副控制底盘自转。
遥控器控制（S2处在down状态时，控制舵机运动）：右杆左右运动副控制拨杆转动，上下控制合页翻转。

## 程序说明

### 程序体系结构

#### 体系框架

1. 使用免费及开源的 freertos 操作系统，兼容其他开源协议 license；
2. 使用标准 CMSIS-RTOS 接口，方便不同操作系统或平台间程序移植；
3. 提供一套抽象步兵机器人bsp，简化上层逻辑；

**application**：上层应用任务，包括系统任务

**bsp**：C型开发板适配包

**components**：通用机器人模块，包括命令行，驱动模块和系统组件

**doc**：说明文档

### 软件体系

固件提供统一的机器人软件栈，所有业务逻辑包含在application中，使用观察者模式分发信息，软件框架如下：


### 硬件体系

1. 主控 MCU：STM32F407IGHx，配置运行频率180MHz
2. 模块通信方式：CAN；CAN设备：电机电调
3. 上下层通信方式：USB虚拟串口
4. 麦轮安装方式：O型

### 协议数据

通过SV2-Linkz连接国际C型板的拷入和修改代码

#### 数据分类

协议数据按照通信方向可以分为两大类：

底层发送给上层的数据：

1. 反馈信息：包含各个机构传感器反馈信息、底层计算出来的一些反馈信息；
2. 底层状态信息：包含底层设备运行状态、底层对上层数据的一些响应等；
3. 转发数据：包含裁判系统的全部信息、服务器端的自定义信息；

底层接收的上层数据：

1. 控制信息：上层对底层 3 个执行机构的控制信息；

